<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.ToggleButton?>
<?import javafx.scene.chart.PieChart?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.image.Image?>
<?import javafx.scene.layout.AnchorPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.StackPane?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.layout.GridPane?>
<?import javafx.scene.layout.ColumnConstraints?>
<?import javafx.scene.layout.RowConstraints?>
<?import javafx.scene.shape.Rectangle?>
<?import javafx.scene.shape.Circle?>
<?import javafx.scene.text.Font?>
<?import java.net.URL?>

<AnchorPane fx:id="root" prefWidth="900"
    stylesheets="/com/the_pathfinders/css/dashboard.css, /com/the_pathfinders/css/tranquil_popup.css, /com/the_pathfinders/css/MoodTracker.css" xmlns="http://javafx.com/javafx/25"
    xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.the_pathfinders.DashboardController">
    <children>
        <!-- Background animated rectangle (fills window) -->
        <Rectangle fx:id="bgRect" AnchorPane.topAnchor="0" AnchorPane.leftAnchor="0"
            AnchorPane.rightAnchor="0" AnchorPane.bottomAnchor="0" mouseTransparent="true" />

        <!-- Vignette shadow effect from left edge -->
        <Rectangle fx:id="vignetteRect" AnchorPane.topAnchor="0" AnchorPane.leftAnchor="0"
            AnchorPane.bottomAnchor="0" width="450" mouseTransparent="true" />

        <!-- Top-left: music toggle -->
        <VBox AnchorPane.leftAnchor="12" AnchorPane.topAnchor="12" spacing="8" alignment="TOP_LEFT">
            <children>
                <ToggleButton fx:id="musicToggle" styleClass="music-toggle" text="Music: On" />
            </children>
        </VBox>

        <!-- Mood Tracker Button (Circle on left side) -->
        <Button fx:id="moodTrackerBtn" styleClass="mood-tracker-circle"
                prefWidth="200" prefHeight="200"
                AnchorPane.leftAnchor="75"
                AnchorPane.topAnchor="150"/>

        <!-- Help Center Button (Bottom left corner) -->
        <Button fx:id="helpCenterBtn" text="?" styleClass="help-center-btn"
                AnchorPane.leftAnchor="20" AnchorPane.bottomAnchor="20"
                prefWidth="50" prefHeight="50"/>

        <!-- Top-center: greeting label -->
        <Label fx:id="greetingLabel" text="Good Morning ðŸŒž" styleClass="greeting" 
            AnchorPane.topAnchor="32" AnchorPane.leftAnchor="0" AnchorPane.rightAnchor="0" 
            alignment="CENTER" />

        <!-- Top-right user info -->
        <HBox alignment="CENTER" spacing="8" AnchorPane.rightAnchor="12" AnchorPane.topAnchor="12">
            <Label fx:id="userLabel" alignment="CENTER_RIGHT" prefHeight="38.0" prefWidth="149.0"
                text="Logged"/>
            <ImageView fx:id="userImage" fitHeight="50.0" fitWidth="50.0" preserveRatio="true" />
        </HBox>

        <!-- Center content: greeting moved upward + draggable button cards -->
        <!-- Button cards: 3 rows Ã— 2 columns, middle row slightly indented -->
        <!-- Button cards: 3 rows Ã— 2 columns, right-aligned and slightly lower -->
        <VBox fx:id="buttonCardsBox"
            spacing="20"
            alignment="CENTER_RIGHT"
            AnchorPane.rightAnchor="100"
            AnchorPane.topAnchor="120">
            <!-- top right bottom left -->
            <children>
                <!-- Row 1 -->
                <HBox alignment="CENTER_RIGHT" spacing="16">
                    <children>
                        <Button fx:id="journalBtn" styleClass="card-btn"
                            prefWidth="250" prefHeight="160" wrapText="true" contentDisplay="GRAPHIC_ONLY">
                            <graphic>
                                <ImageView fitWidth="250" fitHeight="160" preserveRatio="false" smooth="true">
                                    <image>
                                        <Image url="@/assets/images/B1.png" />
                                    </image>
                                </ImageView>
                            </graphic>
                        </Button>
                        <Button fx:id="blogBtn" styleClass="card-btn"
                            prefWidth="250" prefHeight="160" wrapText="true" contentDisplay="GRAPHIC_ONLY">
                            <graphic>
                                <ImageView fitWidth="250" fitHeight="160" preserveRatio="false" smooth="true">
                                    <image>
                                        <Image url="@/assets/images/B2.png" />
                                    </image>
                                </ImageView>
                            </graphic>
                        </Button>
                    </children>
                </HBox>

                <!-- Row 2 (shifted right for staggered look) -->
                <HBox alignment="CENTER_RIGHT" spacing="16" style="-fx-translate-x: 80;">
                    <children>
                        <Button fx:id="moodBtn" styleClass="card-btn"
                            prefWidth="250" prefHeight="160" wrapText="true" contentDisplay="GRAPHIC_ONLY">
                            <graphic>
                                <ImageView fitWidth="250" fitHeight="160" preserveRatio="false" smooth="true">
                                    <image>
                                        <Image url="@/assets/images/B3.png" />
                                    </image>
                                </ImageView>
                            </graphic>
                        </Button>
                        <Button fx:id="insightsBtn" styleClass="card-btn"
                            prefWidth="250" prefHeight="160" wrapText="true" contentDisplay="GRAPHIC_ONLY">
                            <graphic>
                                <ImageView fitWidth="250" fitHeight="160" preserveRatio="false" smooth="true">
                                    <image>
                                        <Image url="@/assets/images/B4.png" />
                                    </image>
                                </ImageView>
                            </graphic>
                        </Button>
                    </children>
                </HBox>

                <!-- Row 3 -->
                <HBox alignment="CENTER_RIGHT" spacing="16">
                    <children>
                        <Button fx:id="SocialWorkBtn" styleClass="card-btn"
                            prefWidth="250" prefHeight="160" wrapText="true" contentDisplay="GRAPHIC_ONLY">
                            <graphic>
                                <ImageView fitWidth="250" fitHeight="160" preserveRatio="false" smooth="true">
                                    <image>
                                        <Image url="@/assets/images/B5.png" />
                                    </image>
                                </ImageView>
                            </graphic>
                        </Button>
                        <Button fx:id="tranquilCornerBtn" styleClass="card-btn"
                            prefWidth="250" prefHeight="160" wrapText="true" contentDisplay="GRAPHIC_ONLY">
                            <graphic>
                                <ImageView fitWidth="250" fitHeight="160" preserveRatio="false" smooth="true">
                                    <image>
                                        <Image url="@/assets/images/B6.png" />
                                    </image>
                                </ImageView>
                            </graphic>
                        </Button>
                    </children>
                </HBox>
            </children>
        </VBox>

        <!-- User dropdown placeholder container (initially empty) -->
        <VBox fx:id="userDropdown" AnchorPane.topAnchor="60" AnchorPane.rightAnchor="12" spacing="6"
            visible="false" managed="false" />

        <!-- Journaling overlay popup (similar to profile's firstTimeOverlay) -->
        <StackPane fx:id="journalingOverlay" visible="false" managed="false"
            AnchorPane.topAnchor="0" AnchorPane.leftAnchor="0" AnchorPane.rightAnchor="0"
            AnchorPane.bottomAnchor="0" styleClass="journaling-overlay-root">
            <children>
                <VBox fx:id="journalingContentBox" spacing="22" alignment="CENTER"
                    styleClass="journaling-popup-box">
                    <children>
                        <ImageView fx:id="journalingIcon" fitWidth="54" fitHeight="54"
                            preserveRatio="true" />
                        <Label fx:id="journalingTitle" text="Journaling"
                            styleClass="journaling-title" />
                        <Label fx:id="journalingSubtitle" text="Choose Option"
                            styleClass="journaling-subtitle" />
                        <VBox fx:id="journalingButtonsBox" spacing="14" alignment="CENTER">
                            <children>
                                <Button fx:id="createJournalBtn" text="Create Journal"
                                    styleClass="journaling-btn" prefWidth="220" prefHeight="48" />
                                <Button fx:id="viewJournalsBtn" text="View Journals"
                                    styleClass="journaling-btn" prefWidth="220" prefHeight="48" />
                            </children>
                        </VBox>
                    </children>
                </VBox>
            </children>
        </StackPane>
<!-- TRANQUIL CORNER POPUP (same as journaling, smaller height) -->
<StackPane fx:id="tranquilOverlay"
           visible="false" managed="false"
           AnchorPane.topAnchor="0" AnchorPane.leftAnchor="0"
           AnchorPane.rightAnchor="0" AnchorPane.bottomAnchor="0"
           styleClass="journaling-overlay-root">

    <children>
        <VBox fx:id="tranquilContentBox"
              spacing="25"
              alignment="CENTER"
              styleClass="journaling-popup-box"
              prefWidth="450" prefHeight="520">

            <!-- ICON -->
            <ImageView fx:id="tranquilIcon" fitWidth="64" fitHeight="64" preserveRatio="true">
                <image>
                    <Image url="@/assets/icons/ques.png"/>
                </image>
            </ImageView>

            <!-- TITLE & SUBTITLE -->
            <Label text="ðŸŒ¸ Tranquil Corner ðŸŒ¸" styleClass="journaling-title" style="-fx-font-size: 32px;"/>
            <Label text="Choose how you'd like to relax" styleClass="journaling-subtitle" style="-fx-font-size: 16px; -fx-font-style: italic;"/>

            <!-- 3 BUTTONS IN COLUMN -->
            <VBox spacing="18" alignment="CENTER">
                <Button fx:id="meditationBtn"
                        text="âœ¨ MEDITATION âœ¨"
                        styleClass="journaling-btn"
                        prefWidth="420" prefHeight="65"
                        style="-fx-font-size: 18px; -fx-background-color: linear-gradient(to right, #E8D5F5, #F0E0FF); -fx-background-radius: 30px; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.15), 8, 0, 0, 3);"/>

                <Button fx:id="calmActivitiesBtn"
                        text="ðŸŒ¸ CALM ACTIVITIES ðŸŒ¸"
                        styleClass="journaling-btn"
                        prefWidth="420" prefHeight="65"
                        style="-fx-font-size: 18px; -fx-background-color: linear-gradient(to right, #FFE8F0, #FFF0F8); -fx-background-radius: 30px; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.15), 8, 0, 0, 3);"/>

                <Button fx:id="pomodoroBtn"
                        text="â±ï¸ POMODORO TIMER â±ï¸"
                        styleClass="journaling-btn"
                        prefWidth="420" prefHeight="65"
                        style="-fx-font-size: 18px; -fx-background-color: linear-gradient(to right, #FFE8D8, #FFF0E5); -fx-background-radius: 30px; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.15), 8, 0, 0, 3);"/>
            </VBox>

            <!-- BACK BUTTON -->
            <Button fx:id="tranquilBackBtn"
                    text="â† Back"
                    styleClass="journaling-btn"
                    prefWidth="200" prefHeight="45"
                    style="-fx-font-size: 16px; -fx-background-radius: 18px;"/>
        </VBox>
    </children>
</StackPane>

<!-- MOOD TRACKER POPUP -->
<StackPane fx:id="moodTrackerOverlay"
           visible="false" managed="false"
           AnchorPane.topAnchor="0" AnchorPane.leftAnchor="0"
           AnchorPane.rightAnchor="0" AnchorPane.bottomAnchor="0"
           styleClass="mood-overlay-root">
    <children>
        <VBox fx:id="moodTrackerContentBox" spacing="20" alignment="CENTER"
              styleClass="mood-popup-box"
              prefWidth="500" maxWidth="500" prefHeight="600" maxHeight="600">

            <!-- Header -->
            <HBox alignment="CENTER_LEFT" spacing="10" styleClass="header-box">
                <Button fx:id="moodBackBtn" text="â†" styleClass="back-btn"/>
                <Label text="Assessment" styleClass="mood-title"/>
                <javafx.scene.layout.Region HBox.hgrow="ALWAYS"/>
                <Label fx:id="moodProgressLabel" text="1 OF 5" styleClass="progress-indicator-label"/>
                <Button fx:id="moodCloseBtn" text="âœ•" styleClass="close-btn"/>
            </HBox>

            <!-- Progress indicator -->
            <HBox alignment="CENTER" spacing="8">
                <javafx.scene.shape.Circle fx:id="progress1" radius="6" styleClass="progress-circle, active"/>
                <javafx.scene.shape.Circle fx:id="progress2" radius="6" styleClass="progress-circle"/>
                <javafx.scene.shape.Circle fx:id="progress3" radius="6" styleClass="progress-circle"/>
                <javafx.scene.shape.Circle fx:id="progress4" radius="6" styleClass="progress-circle"/>
                <javafx.scene.shape.Circle fx:id="progress5" radius="6" styleClass="progress-circle"/>
            </HBox>

            <!-- Scrollable questions container -->
            <ScrollPane fx:id="moodScrollPane" fitToWidth="true" hbarPolicy="NEVER"
                        VBox.vgrow="ALWAYS" styleClass="questions-scroll">
                <VBox fx:id="moodQuestionsContainer" spacing="30" style="-fx-padding: 20;"/>
            </ScrollPane>

            <!-- Navigation buttons -->
            <HBox spacing="15" alignment="CENTER">
                <Button fx:id="moodPrevBtn" text="Previous" styleClass="nav-btn" disable="true"/>
                <Button fx:id="moodNextBtn" text="Next" styleClass="nav-btn"/>
                <Button fx:id="moodSubmitBtn" text="Submit" styleClass="nav-btn, submit-btn"
                        visible="false" managed="false"/>
            </HBox>
        </VBox>

        <!-- Results overlay (initially hidden) -->
        <VBox fx:id="moodResultsBox" spacing="25" alignment="CENTER"
              styleClass="results-box"
              prefWidth="550" maxWidth="550" prefHeight="650" maxHeight="650"
              visible="false" managed="false">

            <Label text="ðŸ“Š Your Mood Analysis" styleClass="results-title"/>

            <!-- Pie chart -->
            <javafx.scene.chart.PieChart fx:id="moodPieChart" legendVisible="true"
                      prefWidth="400" prefHeight="350"/>

            <!-- Summary text -->
            <VBox spacing="10" alignment="CENTER" styleClass="summary-box">
                <Label fx:id="moodSummaryLabel" wrapText="true" alignment="CENTER"
                       styleClass="summary-text" maxWidth="450"/>
                <Label fx:id="moodScoreLabel" styleClass="score-label"/>
            </VBox>

            <!-- Close button -->
            <Button fx:id="moodDoneBtn" text="Done" styleClass="nav-btn, submit-btn" prefWidth="150"/>
        </VBox>
    </children>
</StackPane>

<!-- Help Center Overlay -->
<StackPane fx:id="helpCenterOverlay" visible="false" managed="false"
    AnchorPane.topAnchor="0" AnchorPane.leftAnchor="0" AnchorPane.rightAnchor="0"
    AnchorPane.bottomAnchor="0" style="-fx-background-color: rgba(0,0,0,0.6);">
    <children>
        <VBox fx:id="helpCenterContentBox" spacing="25" alignment="TOP_CENTER"
            style="-fx-background-color: white; -fx-background-radius: 20; -fx-padding: 40; -fx-max-width: 600; -fx-max-height: 450;">
            <children>
                <!-- Title -->
                <VBox spacing="8" alignment="CENTER">
                    <Label text="Help Center" style="-fx-font-size: 28px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;"/>
                    <Label text="Choose the type of assistance you need." style="-fx-font-size: 14px; -fx-text-fill: #7f8c8d;"/>
                </VBox>

                <!-- Technical Support Option -->
                <Button fx:id="technicalSupportBtn" styleClass="help-option-btn"
                    prefWidth="500" prefHeight="100"
                    style="-fx-background-color: linear-gradient(to right, #e8f5e9, #c8e6c9); -fx-background-radius: 20; -fx-border-radius: 20; -fx-cursor: hand; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 8, 0, 0, 2);">
                    <graphic>
                        <HBox spacing="15" alignment="CENTER_LEFT" style="-fx-padding: 10;">
                            <Label text="ðŸ› ï¸" style="-fx-font-size: 32px;"/>
                            <VBox spacing="5">
                                <Label text="Technical Support" style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #2e7d32;"/>
                                <Label text="App issues, bugs, or technical problems" style="-fx-font-size: 12px; -fx-text-fill: #558b2f;"/>
                            </VBox>
                        </HBox>
                    </graphic>
                </Button>

                <!-- Emergency Hotlines Option -->
                <Button fx:id="emergencyHotlinesBtn" styleClass="help-option-btn"
                    prefWidth="500" prefHeight="100"
                    style="-fx-background-color: linear-gradient(to right, #ffebee, #ffcdd2); -fx-background-radius: 20; -fx-border-radius: 20; -fx-cursor: hand; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 8, 0, 0, 2);">
                    <graphic>
                        <HBox spacing="15" alignment="CENTER_LEFT" style="-fx-padding: 10;">
                            <Label text="ðŸš¨" style="-fx-font-size: 32px;"/>
                            <VBox spacing="5">
                                <Label text="Emergency Hotlines" style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #c62828;"/>
                                <Label text="Immediate help, crisis support services" style="-fx-font-size: 12px; -fx-text-fill: #d32f2f;"/>
                            </VBox>
                        </HBox>
                    </graphic>
                </Button>

                <!-- Close Button -->
                <Button fx:id="helpCenterCloseBtn" text="Close" styleClass="journaling-btn"
                    prefWidth="150" prefHeight="40"
                    style="-fx-background-color: #95a5a6; -fx-text-fill: white; -fx-background-radius: 20; -fx-cursor: hand;"/>
            </children>
        </VBox>
    </children>
</StackPane>

<!-- Technical Support View -->
<StackPane fx:id="technicalSupportOverlay" visible="false" managed="false"
    AnchorPane.topAnchor="0" AnchorPane.leftAnchor="0" AnchorPane.rightAnchor="0"
    AnchorPane.bottomAnchor="0" style="-fx-background-color: rgba(0,0,0,0.6);">
    <children>
        <VBox spacing="20" alignment="TOP_CENTER"
            style="-fx-background-color: white; -fx-background-radius: 20; -fx-padding: 40; -fx-max-width: 650; -fx-max-height: 750;">
            <children>
                <!-- Header -->
                <HBox alignment="CENTER_LEFT" spacing="15">
                    <Button fx:id="techSupportBackBtn" text="â†" style="-fx-font-size: 20px; -fx-background-color: transparent; -fx-cursor: hand;"/>
                    <VBox spacing="5">
                        <Label text="ðŸ“§ Developer Support" style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-text-fill: #2e7d32;"/>
                        <Label text="If the app behaves unexpectedly, freezes, or shows incorrect data â€” we're here." 
                            wrapText="true" style="-fx-font-size: 13px; -fx-text-fill: #666;"/>
                    </VBox>
                </HBox>

                <!-- Email Contacts -->
                <ScrollPane fitToWidth="true" style="-fx-background-color: transparent; -fx-border-color: transparent;" prefHeight="250">
                    <VBox spacing="15" style="-fx-padding: 10;">
                        <!-- Email 1 -->
                        <VBox spacing="8" style="-fx-background-color: #f1f8f4; -fx-padding: 15; -fx-background-radius: 12;">
                            <HBox spacing="10" alignment="CENTER_LEFT">
                                <Label text="ðŸ“§" style="-fx-font-size: 16px;"/>
                                <Label fx:id="email1Label" text="raisatabassum2023115989@cs.du.ac.bd" 
                                    style="-fx-font-size: 13px; -fx-text-fill: #1565c0; -fx-underline: true; -fx-cursor: hand;"/>
                            </HBox>
                        </VBox>

                        <!-- Email 2 -->
                        <VBox spacing="8" style="-fx-background-color: #f1f8f4; -fx-padding: 15; -fx-background-radius: 12;">
                            <HBox spacing="10" alignment="CENTER_LEFT">
                                <Label text="ðŸ“§" style="-fx-font-size: 16px;"/>
                                <Label fx:id="email2Label" text="mdabdullah-2023715965@cs.du.ac.bd" 
                                    style="-fx-font-size: 13px; -fx-text-fill: #1565c0; -fx-underline: true; -fx-cursor: hand;"/>
                            </HBox>
                        </VBox>

                        <!-- Email 3 -->
                        <VBox spacing="8" style="-fx-background-color: #f1f8f4; -fx-padding: 15; -fx-background-radius: 12;">
                            <HBox spacing="10" alignment="CENTER_LEFT">
                                <Label text="ðŸ“§" style="-fx-font-size: 16px;"/>
                                <Label fx:id="email3Label" text="the.pathfinders.dev@gmail.com" 
                                    style="-fx-font-size: 13px; -fx-text-fill: #1565c0; -fx-underline: true; -fx-cursor: hand;"/>
                            </HBox>
                        </VBox>
                    </VBox>
                </ScrollPane>

                <!-- Before Contacting Section -->
                <VBox spacing="10" style="-fx-background-color: #fff3e0; -fx-padding: 20; -fx-background-radius: 12;">
                    <Label text="ðŸ’¡ Before contacting us, try:" style="-fx-font-size: 14px; -fx-font-weight: bold; -fx-text-fill: #e65100;"/>
                    <VBox spacing="5" style="-fx-padding-left: 20;">
                        <Label text="â€¢ Restarting the application" style="-fx-font-size: 13px; -fx-text-fill: #424242;"/>
                        <Label text="â€¢ Checking your internet connection" style="-fx-font-size: 13px; -fx-text-fill: #424242;"/>
                        <Label text="â€¢ Logging out and logging in again" style="-fx-font-size: 13px; -fx-text-fill: #424242;"/>
                    </VBox>
                </VBox>

                <!-- Close Button -->
                <Button fx:id="techSupportCloseBtn" text="Close" styleClass="journaling-btn"
                    prefWidth="150" style="-fx-background-color: #2e7d32; -fx-text-fill: white;"/>
            </children>
        </VBox>
    </children>
</StackPane>

<!-- Emergency Hotlines View -->
<StackPane fx:id="emergencyHotlinesOverlay" visible="false" managed="false"
    AnchorPane.topAnchor="0" AnchorPane.leftAnchor="0" AnchorPane.rightAnchor="0"
    AnchorPane.bottomAnchor="0" style="-fx-background-color: rgba(0,0,0,0.6);">
    <children>
        <VBox spacing="20" alignment="TOP_CENTER"
            style="-fx-background-color: white; -fx-background-radius: 20; -fx-padding: 40; -fx-max-width: 700; -fx-max-height: 650;">
            <children>
                <!-- Header -->
                <HBox alignment="CENTER_LEFT" spacing="15">
                    <Button fx:id="emergencyBackBtn" text="â†" style="-fx-font-size: 20px; -fx-background-color: transparent; -fx-cursor: hand;"/>
                    <VBox spacing="5">
                        <Label text="ðŸ”¥ Emergency Hotlines" style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-text-fill: #c62828;"/>
                        <Label text="If you feel unsafe or need immediate help, call a hotline now." 
                            wrapText="true" style="-fx-font-size: 13px; -fx-text-fill: #666;"/>
                    </VBox>
                </HBox>

                <!-- Disclaimer -->
                <VBox spacing="8" style="-fx-background-color: #ffebee; -fx-padding: 15; -fx-background-radius: 12;">
                    <Label text="âš ï¸ Disclaimer" style="-fx-font-size: 14px; -fx-font-weight: bold; -fx-text-fill: #c62828;"/>
                    <Label text="Shelter for Mind is not a crisis center. For immediate danger, contact your local emergency services." 
                        wrapText="true" style="-fx-font-size: 12px; -fx-text-fill: #d32f2f;"/>
                </VBox>

                <!-- Hotlines List -->
                <ScrollPane fitToWidth="true" style="-fx-background-color: transparent; -fx-border-color: transparent;" prefHeight="320">
                    <VBox fx:id="hotlinesContainer" spacing="12" style="-fx-padding: 10;"/>
                </ScrollPane>

                <!-- Create Safety Plan Button -->
                <Button fx:id="createSafetyPlanBtn" text="ðŸ›¡ï¸ Create Your Safety Plan" 
                    style="-fx-background-color: linear-gradient(to right, #66bb6a, #43a047); -fx-text-fill: white; -fx-font-size: 14px; -fx-font-weight: bold; -fx-padding: 12 30; -fx-background-radius: 25; -fx-cursor: hand; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.2), 8, 0, 0, 2);"
                    prefWidth="280"/>

                <!-- Close Button -->
                <Button fx:id="emergencyCloseBtn" text="Close" styleClass="journaling-btn"
                    prefWidth="150" style="-fx-background-color: #c62828; -fx-text-fill: white;"/>
            </children>
        </VBox>
    </children>
</StackPane>

<!-- Safety Plan Popup Overlay -->
<StackPane fx:id="safetyPlanOverlay" visible="false" managed="false"
    AnchorPane.topAnchor="0" AnchorPane.leftAnchor="0" AnchorPane.rightAnchor="0"
    AnchorPane.bottomAnchor="0" style="-fx-background-color: rgba(0,0,0,0.7);">
    <children>
        <VBox spacing="20" alignment="TOP_CENTER"
            style="-fx-background-color: white; -fx-background-radius: 20; -fx-padding: 35; -fx-max-width: 600; -fx-max-height: 600;">
            <children>
                <!-- Header -->
                <HBox alignment="CENTER_LEFT" spacing="15">
                    <Button fx:id="safetyPlanBackBtn" text="â†" style="-fx-font-size: 20px; -fx-background-color: transparent; -fx-cursor: hand;"/>
                    <VBox spacing="5">
                        <Label text="ðŸ›¡ï¸ Create Your Safety Plan" style="-fx-font-size: 22px; -fx-font-weight: bold; -fx-text-fill: #2e7d32;"/>
                        <Label text="Plan ahead for moments when you need support" 
                            wrapText="true" style="-fx-font-size: 12px; -fx-text-fill: #666;"/>
                    </VBox>
                </HBox>

                <ScrollPane fitToWidth="true" style="-fx-background-color: transparent; -fx-border-color: transparent;" prefHeight="350">
                    <VBox spacing="20" style="-fx-padding: 10;">
                        <!-- Question 1 -->
                        <VBox spacing="10">
                            <Label text="Who can you call when you feel this way?" 
                                style="-fx-font-size: 14px; -fx-font-weight: bold; -fx-text-fill: #2e7d32;"/>
                            <Label text="List trusted contacts (friends, family, therapist, etc.)" 
                                wrapText="true" style="-fx-font-size: 11px; -fx-text-fill: #666; -fx-font-style: italic;"/>
                            <javafx.scene.control.TextField fx:id="safetyPlanContact" promptText="e.g., Mom (555-1234), Dr. Smith (555-5678)..."
                                style="-fx-background-color: #f1f8e9; -fx-background-radius: 10; -fx-padding: 12; -fx-border-color: #81c784; -fx-border-width: 2; -fx-border-radius: 10; -fx-font-size: 13px;"/>
                        </VBox>
                        
                        <!-- Question 2 -->
                        <VBox spacing="10">
                            <Label text="What can you do to calm yourself down?" 
                                style="-fx-font-size: 14px; -fx-font-weight: bold; -fx-text-fill: #2e7d32;"/>
                            <Label text="Coping strategies and calming activities" 
                                wrapText="true" style="-fx-font-size: 11px; -fx-text-fill: #666; -fx-font-style: italic;"/>
                            <javafx.scene.control.TextField fx:id="safetyPlanCalm" promptText="e.g., deep breathing, listening to music, walking..."
                                style="-fx-background-color: #f1f8e9; -fx-background-radius: 10; -fx-padding: 12; -fx-border-color: #81c784; -fx-border-width: 2; -fx-border-radius: 10; -fx-font-size: 13px;"/>
                        </VBox>
                        
                        <!-- Question 3 -->
                        <VBox spacing="10">
                            <Label text="Where can you go to feel safe?" 
                                style="-fx-font-size: 14px; -fx-font-weight: bold; -fx-text-fill: #2e7d32;"/>
                            <Label text="Physical spaces where you feel secure and comfortable" 
                                wrapText="true" style="-fx-font-size: 11px; -fx-text-fill: #666; -fx-font-style: italic;"/>
                            <javafx.scene.control.TextField fx:id="safetyPlanPlace" promptText="e.g., my bedroom, the park, library, friend's house..."
                                style="-fx-background-color: #f1f8e9; -fx-background-radius: 10; -fx-padding: 12; -fx-border-color: #81c784; -fx-border-width: 2; -fx-border-radius: 10; -fx-font-size: 13px;"/>
                        </VBox>
                    </VBox>
                </ScrollPane>

                <!-- Action Buttons -->
                <HBox spacing="15" alignment="CENTER">
                    <Button fx:id="saveSafetyPlanBtn" text="ðŸ’¾ Save Safety Plan" 
                        style="-fx-background-color: #2e7d32; -fx-text-fill: white; -fx-font-weight: bold; -fx-font-size: 13px; -fx-padding: 12 25; -fx-background-radius: 25; -fx-cursor: hand; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.2), 8, 0, 0, 2);"
                        prefWidth="180"/>
                    <Button fx:id="cancelSafetyPlanBtn" text="Cancel" 
                        style="-fx-background-color: #e0e0e0; -fx-text-fill: #424242; -fx-font-weight: bold; -fx-font-size: 13px; -fx-padding: 12 25; -fx-background-radius: 25; -fx-cursor: hand;"
                        prefWidth="120"/>
                </HBox>
            </children>
        </VBox>
    </children>
</StackPane>

    </children>
</AnchorPane>
